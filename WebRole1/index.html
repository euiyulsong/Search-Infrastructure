<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8" />
    <title>Web Crawler with FlatKit</title>
    <meta name="description" content="Admin, Dashboard, Bootstrap, Bootstrap 4, Angular, AngularJS" />
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, minimal-ui" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge">

    <!-- for ios 7 style, multi-resolution icon of 152x152 -->
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-barstyle" content="black-translucent">
    <link rel="apple-touch-icon" href="assets/images/logo.png">
    <meta name="apple-mobile-web-app-title" content="Flatkit">
    <!-- for Chrome on Android, multi-resolution icon of 196x196 -->
    <meta name="mobile-web-app-capable" content="yes">
    <link rel="shortcut icon" sizes="196x196" href="assets/images/logo.png">

    <!-- style -->
    <link rel="stylesheet" href="assets/animate.css/animate.min.css" type="text/css" />
    <link rel="stylesheet" href="assets/glyphicons/glyphicons.css" type="text/css" />
    <link rel="stylesheet" href="assets/font-awesome/css/font-awesome.min.css" type="text/css" />
    <link rel="stylesheet" href="assets/material-design-icons/material-design-icons.css" type="text/css" />

    <link rel="stylesheet" href="assets/bootstrap/dist/css/bootstrap.min.css" type="text/css" />
    <!-- build:css assets/styles/app.min.css -->
    <link rel="stylesheet" href="assets/styles/app.css" type="text/css" />
    <!-- endbuild -->
    <link rel="stylesheet" href="assets/styles/font.css" type="text/css" />
</head>
<body>
    <div class="app" id="app">

        <!-- ############ LAYOUT START-->
        <div id="content" class="app-content box-shadow-z0" role="main">

            <div class="app-footer">
                <div class="p-a text-xs">
                    <div class="pull-right text-muted">
                        &copy; Copyright <strong>Flatkit</strong> <span class="hidden-xs-down">- Built with Love v1.1.3</span>
                        <a ui-scroll-to="content"><i class="fa fa-long-arrow-up p-x-sm"></i></a>
                    </div>
                    <div class="nav">
                        <a class="nav-link" href="">About</a>
                        <span class="text-muted">-</span>
                        <a class="nav-link label accent" href="http://themeforest.net/user/flatfull/portfolio?ref=flatfull">Get it</a>
                    </div>
                </div>
            </div>
            <div ui-view class="app-body" id="view">

                <!-- ############ PAGE START-->
                <div class="padding">
                    <div class="margin">
                        <h5 class="m-b-0 _300">Hi User, Welcome back</h5>
                    </div>
                    <div class="row">
                        <div class="col-sm-12 col-md-5 col-lg-4">
                            <div class="row">
                                <div class="col-xs-12">
                                    <div class="box p-a">
                                        <div class="clear">
                                            <div style="text-align: center;" class="text-muted">Crawler state</div>
                                            <h1 style="text-align: center;" class="m-a-0 text-md _800" id="crawlingstate">Loading</h1>
                                        </div>
                                    </div>
                                </div>
                                <div class="col-xs-6">
                                    <div class="box p-a">
                                        <div class="pull-left m-r">
                                            <i class="fa fa-table text-2x text-success m-y-sm"></i>
                                        </div>
                                        <div class="clear">
                                            <div class="text-muted">Table Queue Size</div>
                                            <h4 class="m-a-0 text-md _600" id="sizetable">0</h4>
                                        </div>
                                    </div>
                                </div>
                                <div class="col-xs-6">
                                    <div class="box p-a">
                                        <div class="pull-left m-r">
                                            
                                            <i class="fa fa-link text-2x text-info m-y-sm"></i>
                                        </div>
                                        <div class="clear">
                                            <div class="text-muted">Link Queue Size</div>
                                            <h4 class="m-a-0 text-md _600" id="queuesize">0</h4>
                                        </div>
                                    </div>
                                </div>
                                <div class="col-xs-6">
                                    <div class="box p-a">
                                        <div class="pull-left m-r">
                                            <i class="fa fa-ellipsis-h text-2x text-accent m-y-sm"></i>
                                        </div>
                                        <div class="clear">
                                            <div class="text-muted">#Urls crawled</div>
                                            <h4 id="urlcrawled" class="m-a-0 text-md _600">0</h4>
                                        </div>
                                    </div>
                                </div>
                                <div class="col-xs-6">
                                    <div class="box p-a">
                                        <div class="pull-left m-r">
                                            <i class="fa fa-exclamation-triangle text-2x text-danger m-y-sm"></i>
                                        </div>
                                        <div class="clear">
                                            <div class="text-muted">#Error Urls</div>
                                            <h4 id="numberError" class="m-a-0 text-md _600">0</h4>
                                        </div>
                                    </div>
                                </div>
                                <div class="col-xs-6">
                                    <div class="box p-a">
                                        <div class="pull-left m-r">

                                            <i class="fa fa-link text-2x text-info m-y-sm"></i>
                                        </div>
                                        <div class="clear">
                                            <div class="text-muted">#Title</div>
                                            <h4 class="m-a-0 text-md _600" id="titleNumber">0</h4>
                                        </div>
                                    </div>
                                </div>
                                <div class="col-xs-6">
                                    <div class="box p-a">
                                        <div class="pull-left m-r">
                                            <i class="fa fa-link text-2x text-info m-y-sm"></i>
                                        </div>
                                        <div class="clear">
                                            <div class="text-muted">Last added title</div>
                                            <h4 class="m-a-0 text-md _600" id="lastTitle">0</h4>
                                        </div>
                                    </div>
                                </div>
                                <div class="col-xs-12">
                                    <div class="row-col box-color text-center primary">
                                        <div class="row-cell p-a" style="">
                                            <button id="startButton" type="button" class="btn btn-default btn-lg" style="width: 100%; height: 100%">
                                                <i class="fa fa-play" aria-hidden="true"></i> Start
                                            </button>
                                        </div>
                                        <div class="row-cell p-a dker">
                                            <button id="stopButton" type="button" class="btn btn-default btn-lg" style="width: 100%; height: 100%">
                                                <i class="fa fa-stop" aria-hidden="true"></i> Stop
                                            </button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="box">
                                <div class="box-header">
                                    <h3><i class="fa fa-heart text-2x text-danger m-y-sm"></i> System health </h3>
                                </div>
                                <div class="text-center b-t">
                                    <div class="row-col">
                                        <div class="row-cell p-a">
                                            <div class="inline m-b">
                                                <div id="ram" ui-jp="easyPieChart" class="easyPieChart" ui-refresh="app.setting.color" data-redraw='true' data-percent="55" ui-options="{
                                                            lineWidth: 8,
                                                            trackColor: 'rgba(0,0,0,0.05)',
                                                            barColor: '#0cc2aa',
                                                            scaleColor: 'transparent',
                                                            size: 100,
                                                            scaleLength: 0,
                                                            animate:{
                                                              duration: 3000,
                                                              enabled:true
                                                            }
                                                          }">
                                                    <div>
                                                        <h5 class="ramUsage"></h5>
                                                    </div>
                                                </div>
                                            </div>
                                            <div>
                                                RAM available
                                                <small class="block m-b"><span class="ram"></span></small>
                                            </div>
                                        </div>
                                        <div class="row-cell p-a dker">
                                            <div class="inline m-b">
                                                <div id="cpu" ui-jp="easyPieChart" class="easyPieChart" ui-refresh="app.setting.color" data-redraw='true' data-percent="65" ui-options="{
                                                        lineWidth: 8,
                                                        trackColor: 'rgba(0,0,0,0.05)',
                                                        barColor: '#fcc100',
                                                        scaleColor: 'transparent',
                                                        size: 100,
                                                        scaleLength: 0,
                                                        animate:{
                                                          duration: 3000,
                                                          enabled:true
                                                        }
                                                      }">
                                                    <div>
                                                        <h5 class="cpu"></h5>
                                                    </div>
                                                </div>
                                            </div>
                                            <div>
                                                CPU usage
                                                <small class="block m-b"><span class="cpu"></span></small>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="col-sm-12 col-md-7 col-lg-8">
                            <div id="chartContainer" style="width:100%; height:300px;"></div>
                            <br />
                            <div id="chartContainer2" style="width:100%; height:300px;"></div>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-md-6 col-xl-6">
                            <div class="box indigo-900 lt">
                                <div class="box-header b-b">
                                    <h2>Last 10 Urls</h2>
                                </div>
                                <ul id="last10" class="list">
                                </ul>
                            </div>
                        </div>
                        <div class="col-md-12 col-xl-6">
                            <div class="box">
                                <div class="box-header">
                                    <h3>Error Urls</h3>
                                </div>
                                <ul id="errors" class="list-group no-border">
                                    
                                </ul>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <script src="libs/jquery/jquery/dist/jquery.js"></script>
    <!-- Bootstrap -->
    <script src="libs/jquery/tether/dist/js/tether.min.js"></script>
    <script src="libs/jquery/bootstrap/dist/js/bootstrap.js"></script>
    <!-- core -->
    <script src="libs/jquery/underscore/underscore-min.js"></script>
    <script src="libs/jquery/jQuery-Storage-API/jquery.storageapi.min.js"></script>
    <script src="libs/jquery/PACE/pace.min.js"></script>

    <script src="scripts/config.lazyload.js"></script>

    <script src="scripts/palette.js"></script>
    <script src="scripts/ui-load.js"></script>
    <script src="scripts/canvasjs.min.js"></script>
    <script src="scripts/ui-jp.js"></script>
    <script src="scripts/ui-include.js"></script>
    <script src="scripts/ui-device.js"></script>
    <script src="scripts/ui-form.js"></script>
    <script src="scripts/ui-nav.js"></script>
    <script src="scripts/ui-screenfull.js"></script>
    <script src="scripts/ui-scroll-to.js"></script>
    <script src="scripts/ui-toggle-class.js"></script>

    <script src="scripts/app.js"></script>

    <!-- ajax -->
    <script src="libs/jquery/jquery-pjax/jquery.pjax.js"></script>
    <script src="scripts/ajax.js"></script>
    <script type="text/javascript">
    $("#startButton").click(function () {
        console.log("resume crawling");
        $.ajax({
            type: "POST",
            url: "Admin.asmx/ResumeCrawling",
            data: "",
            contentType: "application/json; charset=utf-8",
            dataType: "json",
            success: function (msg) {
                console.log("resumed");
            }
        })
    });
    $("#stopButton").click(function () {
        console.log("stop crawling");
        $.ajax({
            type: "POST",
            url: "Admin.asmx/StopCrawling",
            data: "",
            contentType: "application/json; charset=utf-8",
            dataType: "json",
            success: function (msg) {
                console.log("stopped");
            }
        })
    });
    window.onload = function () {
        var chart = new CanvasJS.Chart("chartContainer", {
            title: {
                text: "Link Queue Size"
            },
            data: [
            {
                type: "spline",
                dataPoints: [
                  { y: 0 }
                ]
            }
            ]
        });
        chart.render();
        var chart2 = new CanvasJS.Chart("chartContainer2", {
            title: {
                text: "#Urls crawled"
            },
            data: [
            {
                type: "spline",
                dataPoints: [
                  { y: 0 }
                ]
            }
            ]
        });
        chart2.render();
        window.setInterval(function () {
            $.ajax({
                type: "POST",
                url: "Admin.asmx/UpdateDashboard",
                data: "",
                contentType: "application/json; charset=utf-8",
                dataType: "json",
                success: function (msg) {
                    var result = JSON.parse(msg.d);
                    $("#last10").empty();
                    $("#errors").empty();
                    console.log(result);
                    $("#crawlingstate").text(result.CrawlingState);
                    $("#queuesize").text(result.SizeOfQueue);
                    $("#sizetable").text(result.SizeOfTable);
                    $("#cpu").attr("data-percent", result.CpuUsage + "");
                    $(".cpu").text(result.CpuUsage.toFixed(1) + " %")
                    $("#cpu").easyPieChart({
                        lineWidth: 8,
                        trackColor: 'rgba(0,0,0,0.05)',
                        barColor: '#fcc100',
                        scaleColor: 'transparent',
                        size: 100,
                        scaleLength: 0,
                        animate: {
                            duration: 3000,
                            enabled: true
                        }
                    });
                    $("#ram").attr("data-percent", (result.RamAvailable / 1750) * 100);
                    $("#ram").easyPieChart({
                        lineWidth: 8,
                        trackColor: 'rgba(0,0,0,0.05)',
                        barColor: '#fcc100',
                        scaleColor: 'transparent',
                        size: 100,
                        scaleLength: 0,
                        animate: {
                            duration: 3000,
                            enabled: true
                        }
                    });
                    $(".ramUsage").text(((result.RamAvailable / 1750) * 100).toFixed(1) + "%");
                    $(".ram").text(result.RamAvailable + " MBytes");

                    $("#urlcrawled").text(result.NumberOfUrlsCrawled);
                    var last10 = JSON.parse(result.last10Urls);
                    last10.reverse();
                    $("#ram").attr("data-percent", result.RamAvailable);
                    var errors = JSON.parse(result.errorUris);
                    $("#numberError").text(result.errorNumber);
                    last10.forEach(function (url) {
                        $("#last10").append("<li class=" + "list-item" + ">" + url + "</li>");
                    })
                    errors.forEach(function (error) {
                        var error = error.split(" | ");
                        var url = error[0];
                        $("#errors").append("<li class=" + "list-item" + ">" + url + " has  the error code of " + error[1].substring(error[1].indexOf('(') + 1, error[1].indexOf(')')) + "</li>");
                    });
                    var length = chart.options.data[0].dataPoints.length;
                    chart.options.data[0].dataPoints.push({ y: result.SizeOfQueue });
                    chart2.options.data[0].dataPoints.push({ y: result.NumberOfUrlsCrawled });
                    chart2.render();
                    chart.render();
                }
            })
        }, 5000);
        window.setInterval(function () {
            $.ajax({
                type: "POST",
                url: "getQuerySuggestions.asmx/getTitle",
                data: "",
                contentType: "application/json; charset=utf-8",
                dataType: "json",
                success: function (msg) {
                    var result = JSON.parse(msg.d);
                    $("#titleNumber").text(result.numberOfTitle);
                    $("#lastTitle").text(result.lastTitle);
                }
            })
        }, 5000);
    }
    </script>
    <script>
    </script>
</body>
</html>
